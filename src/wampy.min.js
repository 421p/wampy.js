("function"==typeof define?function(m){define("Wampy",m)}:"object"==typeof exports?function(m){module.exports=m()}:function(m){this.Wampy=m()})(function(){function getServerUrl(url){var scheme,port,path;return url?/^ws/.test(url)?url:/:\d{1,5}/.test(url)?(scheme="https:"===window.location.protocol?"wss://":"ws://",scheme+url):(scheme="https:"===window.location.protocol?"wss://":"ws://",port=""!==window.location.port?":"+window.location.port:"",path="/"===url[0]?url:"/"+url,scheme+window.location.hostname+port+path):(scheme="https:"===window.location.protocol?"wss://":"ws://",port=""!==window.location.port?":"+window.location.port:"",scheme+window.location.hostname+port+"/ws")}function getWebSocket(url,protocols){var parsedUrl=getServerUrl(url);return"WebSocket"in window?protocols?new WebSocket(parsedUrl,protocols):new WebSocket(parsedUrl):"MozWebSocket"in window?protocols?new MozWebSocket(parsedUrl,protocols):new MozWebSocket(parsedUrl):null}var WAMP_MSG_SPEC={HELLO:1,WELCOME:2,ABORT:3,CHALLENGE:4,AUTHENTICATE:5,GOODBYE:6,HEARTBEAT:7,ERROR:8,PUBLISH:16,PUBLISHED:17,SUBSCRIBE:32,SUBSCRIBED:33,UNSUBSCRIBE:34,UNSUBSCRIBED:35,EVENT:36,CALL:48,CANCEL:49,RESULT:50,REGISTER:64,REGISTERED:65,UNREGISTER:66,UNREGISTERED:67,INVOCATION:68,INTERRUPT:69,YIELD:70},WAMP_ERROR_MSG={SUCCESS:{code:0,description:"Success!"},URI_ERROR:{code:1,description:"Topic URI doesn't meet requirements!"},NO_BROKER:{code:2,description:"Server doesn't provide broker role!"},NO_CALLBACK_SPEC:{code:3,description:"No required callback function specified!"},INVALID_PARAM:{code:4,description:"Invalid parameter(s) specified!"},NON_EXIST_SUBSCRIBE_CONFIRM:{code:5,description:"Received subscribe confirmation to non existent subscription!"},NON_EXIST_SUBSCRIBE_ERROR:{code:6,description:"Received error for non existent subscription!"},NON_EXIST_UNSUBSCRIBE:{code:7,description:"Trying to unsubscribe from non existent subscription!"},NON_EXIST_SUBSCRIBE_UNSUBSCRIBED:{code:8,description:"Received unsubscribe confirmation to non existent subscription!"},NON_EXIST_PUBLISH_ERROR:{code:9,description:"Received error for non existent publication!"},NON_EXIST_PUBLISH_PUBLISHED:{code:10,description:"Received publish confirmation for non existent publication!"},NON_EXIST_SUBSCRIBE_EVENT:{code:11,description:"Received event for non existent subscription!"},NO_DEALER:{code:12,description:"Server doesn't provide dealer role!"},NON_EXIST_CALL_RESULT:{code:13,description:"Received rpc result for non existent call!"},NON_EXIST_CALL_ERROR:{code:14,description:"Received rpc call error for non existent call!"},RPC_ALREADY_REGISTERED:{code:15,description:"RPC already registered!"},NON_EXIST_RPC_REG:{code:16,description:"Received rpc registration confirmation for non existent rpc!"},NON_EXIST_RPC_UNREG:{code:17,description:"Received rpc unregistration confirmation for non existent rpc!"},NON_EXIST_RPC_ERROR:{code:18,description:"Received error for non existent rpc!"},NON_EXIST_RPC_INVOCATION:{code:19,description:"Received invocation for non existent rpc!"}},Wampy=function(url,options){switch(this.version="v2.0.0",this._url="string"==typeof arguments[0]?url:void 0,this._protocols=["wamp.2.json"],this._wamp_features={agent:"Wampy.js "+this.version,roles:{publisher:{features:{subscriber_blackwhite_listing:!0,publisher_exclusion:!0,publisher_identification:!0}},subscriber:{},caller:{features:{callee_blackwhite_listing:!0,caller_exclusion:!0,caller_identification:!0}},callee:{features:{caller_identification:!0}}}},this._cache={sessionId:null,server_wamp_features:{roles:{}},isSayingGoodbye:!1,opStatus:{code:0,description:"Success!"},timer:null,reconnectingAttempts:0},this._ws=null,this._wsQueue=[],this._requests={},this._calls={},this._subscriptions={},this._rpcRegs={},this._options={autoReconnect:!0,reconnectInterval:2e3,maxRetries:25,transportEncoding:"json",realm:window.location.hostname,onConnect:null,onClose:null,onError:null,onReconnect:null},arguments.length){case 1:"string"!=typeof arguments[0]&&(this._options=this._merge(this._options,arguments[0]));break;case 2:this._options=this._merge(this._options,options)}this._setWsProtocols(),this._ws=getWebSocket(this._url,this._protocols),this._initWsCallbacks()};return Wampy.prototype._getReqId=function(){var reqId;do reqId=Math.floor(9007199254740992*Math.random());while(reqId in this._requests);return reqId},Wampy.prototype._merge=function(){var i,attr,obj={},l=arguments.length;for(i=0;l>i;i++)for(attr in arguments[i])obj[attr]=arguments[i][attr];return obj},Wampy.prototype._isArray=function(obj){return!!obj&&obj.constructor===Array},Wampy.prototype._isObject=function(obj){return obj===Object(obj)&&"[object Array]"!==Object.prototype.toString.call(obj)},Wampy.prototype._isPlainObject=function(obj){return!!obj&&obj.constructor===Object},Wampy.prototype._setWsProtocols=function(){void 0!==window.msgpack&&(this._protocols="msgpack"===this._options.transportEncoding?["wamp.2.msgpack","wamp.2.json"]:["wamp.2.json","wamp.2.msgpack"])},Wampy.prototype._validateURI=function(uri){var re=/^([0-9a-z_]{2,}\.)*([0-9a-z_]{2,})$/;return re.test(uri)&&0!==uri.indexOf("wamp")?!0:!1},Wampy.prototype._encode=function(msg){var bytearray;if("msgpack"!==this._options.transportEncoding)return JSON.stringify(msg);try{return bytearray=new Uint8Array(msgpack.encode(msg)),bytearray.buffer}catch(e){throw new Error("[wampy] no msgpack encoder available!")}},Wampy.prototype._decode=function(msg){if("msgpack"!==this._options.transportEncoding)return JSON.parse(msg);try{return msgpack.decode(msg)}catch(e){throw new Error("[wampy] no msgpack encoder available!")}},Wampy.prototype._send=function(msg){if(msg&&this._wsQueue.push(this._encode(msg)),1===this._ws.readyState)for(;this._wsQueue.length;)this._ws.send(this._wsQueue.shift())},Wampy.prototype._resetState=function(){this._wsQueue=[],this._subscriptions={},this._requests={},this._calls={},this._rpcRegs={},this._cache={reconnectingAttempts:0}},Wampy.prototype._initWsCallbacks=function(){var self=this;this._ws.onopen=function(){self._wsOnOpen.call(self)},this._ws.onclose=function(event){self._wsOnClose.call(self,event)},this._ws.onmessage=function(event){self._wsOnMessage.call(self,event)},this._ws.onerror=function(error){self._wsOnError.call(self,error)}},Wampy.prototype._wsOnOpen=function(){var p;console.log("[wampy] websocket connected"),this._ws.protocol instanceof Array||(p=this._ws.protocol.split("."),this._options.transportEncoding=p[2]),"msgpack"===this._options.transportEncoding&&(this._ws.binaryType="arraybuffer"),this._send([WAMP_MSG_SPEC.HELLO,this._options.realm,this._wamp_features])},Wampy.prototype._wsOnClose=function(){var self=this;console.log("[wampy] websocket disconnected"),this._cache.sessionId&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries?this._cache.timer=window.setTimeout(function(){self._wsReconnect.call(self)},this._options.reconnectInterval):(this._options.onClose&&this._options.onClose(),this._resetState(),this._ws=null)},Wampy.prototype._wsOnMessage=function(event){var data,id,i,d,result,msg;switch(console.log("[wampy] websocket message received",event.data),data=this._decode(event.data),data[0]){case WAMP_MSG_SPEC.WELCOME:this._cache.sessionId=data[1],this._cache.server_wamp_features=data[2],this._options.onConnect&&this._options.onConnect(),this._send();break;case WAMP_MSG_SPEC.ABORT:this._options.onError&&this._options.onError(data[1].message?data[1].message:data[2]),this._ws.close();break;case WAMP_MSG_SPEC.CHALLENGE:break;case WAMP_MSG_SPEC.GOODBYE:this._cache.isSayingGoodbye||this._send([WAMP_MSG_SPEC.GOODBYE,{},"wamp.error.goodbye_and_out"]),this._cache.sessionId=null,this._ws.close();break;case WAMP_MSG_SPEC.HEARTBEAT:break;case WAMP_MSG_SPEC.ERROR:switch(data[1]){case WAMP_MSG_SPEC.SUBSCRIBE:case WAMP_MSG_SPEC.UNSUBSCRIBE:this._requests[data[2]]?(this._requests[data[2]].callbacks.onError&&this._requests[data[2]].callbacks.onError(data[4]),delete this._requests[data[2]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_SUBSCRIBE_ERROR;break;case WAMP_MSG_SPEC.PUBLISH:this._requests[data[2]]?(this._requests[data[2]].callbacks.onError&&this._requests[data[2]].callbacks.onError(data[4]),delete this._requests[data[2]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_PUBLISH_ERROR;break;case WAMP_MSG_SPEC.REGISTER:case WAMP_MSG_SPEC.UNREGISTER:this._requests[data[2]]?(this._requests[data[2]].callbacks.onError&&this._requests[data[2]].callbacks.onError(data[4]),delete this._requests[data[2]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_RPC_ERROR;break;case WAMP_MSG_SPEC.INVOCATION:break;case WAMP_MSG_SPEC.CALL:if(this._calls[data[2]].onError){switch(data.length){case 5:d=null;break;case 6:d=data[5];break;case 7:d=data[6]}this._calls[data[2]].onError(d),delete this._calls[data[2]]}else this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_CALL_ERROR}break;case WAMP_MSG_SPEC.SUBSCRIBED:this._requests[data[1]]?(this._subscriptions[this._requests[data[1]].topic]=this._subscriptions[data[2]]={id:data[2],callbacks:[this._requests[data[1]].callbacks.onEvent]},this._requests[data[1]].callbacks.onSuccess&&this._requests[data[1]].callbacks.onSuccess(),delete this._requests[data[1]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_SUBSCRIBE_CONFIRM;break;case WAMP_MSG_SPEC.UNSUBSCRIBED:this._requests[data[1]]?(id=this._subscriptions[this._requests[data[1]].topic].id,delete this._subscriptions[this._requests[data[1]].topic],delete this._subscriptions[id],this._requests[data[1]].callbacks.onSuccess&&this._requests[data[1]].callbacks.onSuccess(),delete this._requests[data[1]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_SUBSCRIBE_UNSUBSCRIBED;break;case WAMP_MSG_SPEC.PUBLISHED:this._requests[data[1]]?(this._requests[data[1]].callbacks.onSuccess&&this._requests[data[1]].callbacks.onSuccess(),delete this._requests[data[1]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_PUBLISH_PUBLISHED;break;case WAMP_MSG_SPEC.EVENT:if(this._subscriptions[data[1]]){switch(data.length){case 4:d=null;break;case 5:d=data[4];break;case 6:d=data[5]}for(i=this._subscriptions[data[1]].callbacks.length;i--;)this._subscriptions[data[1]].callbacks[i](d)}else this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_SUBSCRIBE_EVENT;break;case WAMP_MSG_SPEC.RESULT:if(this._calls[data[1]]){switch(data.length){case 3:d=null;break;case 4:d=data[3];break;case 5:d=data[4]}this._calls[data[1]].onSuccess(d),delete this._calls[data[1]]}else this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_CALL_RESULT;break;case WAMP_MSG_SPEC.REGISTER:break;case WAMP_MSG_SPEC.REGISTERED:this._requests[data[1]]?(this._rpcRegs[this._requests[data[1]].topic]=this._rpcRegs[data[2]]={id:data[2],callbacks:[this._requests[data[1]].callbacks.rpc]},this._requests[data[1]].callbacks.onSuccess&&this._requests[data[1]].callbacks.onSuccess(),delete this._requests[data[1]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_RPC_REG;break;case WAMP_MSG_SPEC.UNREGISTER:break;case WAMP_MSG_SPEC.UNREGISTERED:this._requests[data[1]]?(id=this._rpcRegs[this._requests[data[1]].topic].id,delete this._rpcRegs[this._requests[data[1]].topic],delete this._rpcRegs[id],this._requests[data[1]].callbacks.onSuccess&&this._requests[data[1]].callbacks.onSuccess(),delete this._requests[data[1]]):this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_RPC_UNREG;break;case WAMP_MSG_SPEC.INVOCATION:if(this._rpcRegs[data[2]]){switch(data.length){case 4:d=null;break;case 5:d=data[4];break;case 6:d=data[5]}try{result=this._rpcRegs[data[2]].callbacks[0](d)}catch(e){return this._send([WAMP_MSG_SPEC.ERROR,WAMP_MSG_SPEC.INVOCATION,data[1],{},"wamp.error.invocation_exception"]),void 0}msg=this._isArray(result)?[WAMP_MSG_SPEC.YIELD,data[1],{},result]:this._isPlainObject(result)?[WAMP_MSG_SPEC.YIELD,data[1],{},[],result]:void 0===result?[WAMP_MSG_SPEC.YIELD,data[1],{}]:[WAMP_MSG_SPEC.YIELD,data[1],{},[result]],this._send(msg)}else this._send([WAMP_MSG_SPEC.ERROR,WAMP_MSG_SPEC.INVOCATION,data[1],{},"wamp.error.no_such_procedure"]),this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_RPC_INVOCATION;break;case WAMP_MSG_SPEC.INTERRUPT:break;case WAMP_MSG_SPEC.YIELD:}},Wampy.prototype._wsOnError=function(error){console.log("[wampy] websocket error"),this._options.onError&&this._options.onError(error)},Wampy.prototype._wsReconnect=function(){console.log("[wampy] websocket reconnecting..."),this._options.onReconnect&&this._options.onReconnect(),this._cache.reconnectingAttempts++,this._ws=getWebSocket(this._url,this._protocols),this._initWsCallbacks()},Wampy.prototype.options=function(opts){return void 0===opts?this._options:this._isPlainObject(opts)?(this._options=this._merge(this._options,opts),this):void 0},Wampy.prototype.getOpStatus=function(){return this._cache.opStatus},Wampy.prototype.connect=function(url){return url&&(this._url=url),this._setWsProtocols(),this._ws=getWebSocket(this._url,this._protocols),this._initWsCallbacks(),this},Wampy.prototype.disconnect=function(){return this._cache.sessionId&&(this._cache.isSayingGoodbye=!0,this._send([WAMP_MSG_SPEC.GOODBYE,{},"wamp.error.system_shutdown"])),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this},Wampy.prototype.abort=function(){return this._cache.sessionId||1!==this._ws.readyState||(this._send([WAMP_MSG_SPEC.ABORT,{},"wamp.error.abort"]),this._cache.sessionId=null),this._ws.close(),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this},Wampy.prototype.subscribe=function(topicURI,callbacks){var reqId;if(!this._cache.server_wamp_features.roles.broker)return this._cache.opStatus=WAMP_ERROR_MSG.NO_BROKER,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if(!this._validateURI(topicURI))return this._cache.opStatus=WAMP_ERROR_MSG.URI_ERROR,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if("function"==typeof callbacks)callbacks={onEvent:callbacks};else if(!this._isPlainObject(callbacks)||void 0===callbacks.onEvent)return this._cache.opStatus=WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;return this._subscriptions[topicURI]?(this._subscriptions[topicURI].callbacks.indexOf(callbacks.onEvent)<0&&this._subscriptions[topicURI].callbacks.push(callbacks.onEvent),callbacks.onSuccess&&callbacks.onSuccess()):(reqId=this._getReqId(),this._requests[reqId]={topic:topicURI,callbacks:callbacks},this._send([WAMP_MSG_SPEC.SUBSCRIBE,reqId,{},topicURI])),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this},Wampy.prototype.unsubscribe=function(topicURI,callbacks){var reqId,i=-1;return this._cache.server_wamp_features.roles.broker?this._subscriptions[topicURI]?(reqId=this._getReqId(),void 0===callbacks?(this._subscriptions[topicURI].callbacks=[],callbacks={}):"function"==typeof callbacks?(i=this._subscriptions[topicURI].callbacks.indexOf(callbacks),callbacks={onEvent:callbacks}):i=this._subscriptions[topicURI].callbacks.indexOf(callbacks.onEvent),i>=0&&this._subscriptions[topicURI].callbacks.splice(i,1),this._subscriptions[topicURI].callbacks.length?(this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this):(this._requests[reqId]={topic:topicURI,callbacks:callbacks},this._send([WAMP_MSG_SPEC.UNSUBSCRIBE,reqId,this._subscriptions[topicURI].id]),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this)):(this._cache.opStatus=WAMP_ERROR_MSG.NON_EXIST_UNSUBSCRIBE,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this):(this._cache.opStatus=WAMP_ERROR_MSG.NO_BROKER,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this)},Wampy.prototype.publish=function(topicURI,payload,callbacks,advancedOptions){var reqId,msg,options={},err=!1;if(!this._cache.server_wamp_features.roles.broker)return this._cache.opStatus=WAMP_ERROR_MSG.NO_BROKER,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if(!this._validateURI(topicURI))return this._cache.opStatus=WAMP_ERROR_MSG.URI_ERROR,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if(this._isPlainObject(callbacks)&&(options.acknowledge=!0),void 0!==advancedOptions&&(this._isPlainObject(advancedOptions)?(advancedOptions.exclude&&(this._isArray(advancedOptions.exclude)?options.exclude=advancedOptions.exclude:"number"==typeof advancedOptions.exclude?options.exclude=[advancedOptions.exclude]:err=!0),advancedOptions.eligible&&(this._isArray(advancedOptions.eligible)?options.eligible=advancedOptions.eligible:"number"==typeof advancedOptions.eligible?options.eligible=[advancedOptions.eligible]:err=!0),advancedOptions.exclude_me&&(options.exclude_me=advancedOptions.exclude_me!==!1),advancedOptions.disclose_me&&(options.disclose_me=advancedOptions.disclose_me===!0)):err=!0,err))return this._cache.opStatus=WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;switch(reqId=this._getReqId(),arguments.length){case 1:msg=[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI];break;case 2:msg=this._isArray(payload)?[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI,payload]:this._isPlainObject(payload)?[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI,[],payload]:[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI,[payload]];break;default:this._requests[reqId]={topic:topicURI,callbacks:callbacks},msg=this._isArray(payload)?[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI,payload]:this._isPlainObject(payload)?[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI,[],payload]:[WAMP_MSG_SPEC.PUBLISH,reqId,options,topicURI,[payload]]}return this._send(msg),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this},Wampy.prototype.call=function(topicURI,payload,callbacks,advancedOptions){var reqId,msg,options={},err=!1;if(!this._cache.server_wamp_features.roles.dealer)return this._cache.opStatus=WAMP_ERROR_MSG.NO_DEALER,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if(!this._validateURI(topicURI))return this._cache.opStatus=WAMP_ERROR_MSG.URI_ERROR,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if("function"==typeof callbacks)callbacks={onSuccess:callbacks};else if(!this._isPlainObject(callbacks)||void 0===callbacks.onSuccess)return this._cache.opStatus=WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if(void 0!==advancedOptions&&(this._isPlainObject(advancedOptions)?(advancedOptions.exclude&&(this._isArray(advancedOptions.exclude)?options.exclude=advancedOptions.exclude:"number"==typeof advancedOptions.exclude?options.exclude=[advancedOptions.exclude]:err=!0),advancedOptions.eligible&&(this._isArray(advancedOptions.eligible)?options.eligible=advancedOptions.eligible:"number"==typeof advancedOptions.eligible?options.eligible=[advancedOptions.eligible]:err=!0),advancedOptions.exclude_me&&(options.exclude_me=advancedOptions.exclude_me!==!1),advancedOptions.disclose_me&&(options.disclose_me=advancedOptions.disclose_me===!0)):err=!0,err))return this._cache.opStatus=WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;do reqId=this._getReqId();while(reqId in this._calls);return this._calls[reqId]=callbacks,msg=payload?this._isArray(payload)?[WAMP_MSG_SPEC.CALL,reqId,options,topicURI,payload]:this._isPlainObject(payload)?[WAMP_MSG_SPEC.CALL,reqId,options,topicURI,[],payload]:[WAMP_MSG_SPEC.CALL,reqId,options,topicURI,[payload]]:[WAMP_MSG_SPEC.CALL,reqId,options,topicURI],this._send(msg),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS,this},Wampy.prototype.register=function(topicURI,callbacks){var reqId;if(!this._cache.server_wamp_features.roles.dealer)return this._cache.opStatus=WAMP_ERROR_MSG.NO_DEALER,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if(!this._validateURI(topicURI))return this._cache.opStatus=WAMP_ERROR_MSG.URI_ERROR,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;if("function"==typeof callbacks)callbacks={rpc:callbacks};else if(!this._isPlainObject(callbacks)||void 0===callbacks.rpc)return this._cache.opStatus=WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this;return this._rpcRegs[topicURI]?(this._cache.opStatus=WAMP_ERROR_MSG.RPC_ALREADY_REGISTERED,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description)):(reqId=this._getReqId(),this._requests[reqId]={topic:topicURI,callbacks:callbacks},this._send([WAMP_MSG_SPEC.REGISTER,reqId,{},topicURI]),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS),this},Wampy.prototype.unregister=function(topicURI,callbacks){var reqId;return this._cache.server_wamp_features.roles.dealer?this._validateURI(topicURI)?("function"==typeof callbacks&&(callbacks={onSuccess:callbacks}),this._rpcRegs[topicURI]?(reqId=this._getReqId(),this._requests[reqId]={topic:topicURI,callbacks:callbacks},this._send([WAMP_MSG_SPEC.UNREGISTER,reqId,this._rpcRegs[topicURI].id]),this._cache.opStatus=WAMP_ERROR_MSG.SUCCESS):(this._cache.opStatus=WAMP_ERROR_MSG.RPC_ALREADY_REGISTERED,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description)),this):(this._cache.opStatus=WAMP_ERROR_MSG.URI_ERROR,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this):(this._cache.opStatus=WAMP_ERROR_MSG.NO_DEALER,this._isPlainObject(callbacks)&&callbacks.onError&&callbacks.onError(this._cache.opStatus.description),this)},Wampy});