<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Wampy.js by KSDaemon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Wampy.js</h1>
      <h2 class="project-tagline">Simple WAMP (WebSocket Application Messaging Protocol) Javascript client-side implementation</h2>
      <a href="https://github.com/KSDaemon/wampy.js" class="btn">View on GitHub</a>
      <a href="https://github.com/KSDaemon/wampy.js/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/KSDaemon/wampy.js/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="wampyjs" class="anchor" href="#wampyjs" aria-hidden="true"><span class="octicon octicon-link"></span></a>wampy.js</h1>

<p>Simple WAMP (WebSocket Application Messaging Protocol) Javascript client-side implementation</p>

<p><a href="https://www.npmjs.com/package/wampy"><img src="https://img.shields.io/npm/v/wampy.svg?style=flat" alt="NPM version"></a>
<a href="https://travis-ci.org/KSDaemon/wampy.js"><img src="https://img.shields.io/travis/KSDaemon/wampy.js/dev.svg?style=flat" alt="Build Status"></a>
<a href="https://coveralls.io/github/KSDaemon/wampy.js"><img src="https://img.shields.io/coveralls/KSDaemon/wampy.js/dev.svg?style=flat" alt="Code coverage"></a>
<a href="https://david-dm.org/KSDaemon/wampy.js"><img src="https://david-dm.org/KSDaemon/wampy.js.svg?style=flat" alt="Dependency Status"></a>
<a href="https://david-dm.org/KSDaemon/wampy.js"><img src="https://david-dm.org/KSDaemon/wampy.js/dev-status.svg?style=flat" alt="DevDependency Status"></a>
<a href="http://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="MIT License"></a></p>

<p><a href="https://gitter.im/KSDaemon/wampy.js"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter Chat"></a></p>

<h1>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h1>

<ul>
<li><a href="#description">Description</a></li>
<li><a href="#usage-example">Usage example</a></li>
<li><a href="#quick-comparison-to-other-libs">Quick comparison to other libs</a></li>
<li><a href="#installation">Installation</a></li>
<li>
<a href="#methods">Methods</a>

<ul>
<li><a href="#constructorurl-options">Constructor</a></li>
<li><a href="#optionsopts">options</a></li>
<li><a href="#getopstatus">getOpStatus</a></li>
<li><a href="#getsessionid">getSessionId</a></li>
<li><a href="#connecturl">connect</a></li>
<li><a href="#disconnect">disconnect</a></li>
<li><a href="#abort">abort</a></li>
<li><a href="#subscribetopicuri-callbacks">subscribe</a></li>
<li><a href="#unsubscribetopicuri-callbacks">unsubscribe</a></li>
<li><a href="#publishtopicuri-payload-callbacks-advancedoptions">publish</a></li>
<li><a href="#calltopicuri-payload-callbacks-advancedoptions">call</a></li>
<li><a href="#cancelreqId-callbacks-advancedOptions">cancel</a></li>
<li><a href="#registertopicuri-callbacks">register</a></li>
<li><a href="#unregistertopicuri-callbacks">unregister</a></li>
</ul>
</li>
<li><a href="#tests-and-code-coverage">Tests and code coverage</a></li>
<li><a href="#copyright-and-license">Copyright and License</a></li>
<li><a href="#see-also">See Also</a></li>
</ul>

<h1>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description</h1>

<p>Wampy.js is client-side javascript library. It implements <a href="http://wamp.ws">WAMP</a> v2 specification on top of
WebSocket object, also provides additional features like autoreconnecting and use of Chaining Pattern.
It has no external dependencies (by default) and is easy to use. Also it's compatible with AMD and browserify.</p>

<p>Wampy.js supports next WAMP roles and features:</p>

<ul>
<li>publisher: advanced profile with features:

<ul>
<li>subscriber blackwhite listing</li>
<li>publisher exclusion</li>
<li>publisher identification</li>
</ul>
</li>
<li>subscriber: basic profile.</li>
<li>caller: advanced profile with features:

<ul>
<li>callee blackwhite listing.</li>
<li>caller exclusion.</li>
<li>caller identification.</li>
<li>progressive call results.</li>
</ul>
</li>
<li>callee: basic profile.</li>
</ul>

<p>Wampy default serializer is JSON, but it also supports msgpack as serializer, but you need to include msgpack.js as dependency.</p>

<p>For v1 WAMP implementation, please see tag v0.1.0.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="usage-example" class="anchor" href="#usage-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage example</h1>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> ws <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Wampy</span>(<span class="pl-s"><span class="pl-pds">'</span>/ws/<span class="pl-pds">'</span></span>, { realm<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>AppRealm<span class="pl-pds">'</span></span> });
ws.<span class="pl-c1">subscribe</span>(<span class="pl-s"><span class="pl-pds">'</span>system.monitor.update<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">data</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Received system.monitor.update event!<span class="pl-pds">'</span></span>); })
  .<span class="pl-c1">subscribe</span>(<span class="pl-s"><span class="pl-pds">'</span>client.message<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">data</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Received client.message event!<span class="pl-pds">'</span></span>); })

ws.<span class="pl-c1">call</span>(<span class="pl-s"><span class="pl-pds">'</span>get.server.time<span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>, {
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">stime</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC successfully called<span class="pl-pds">'</span></span>);
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Server time is <span class="pl-pds">'</span></span> <span class="pl-k">+</span> stime);
    },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC call failed with error <span class="pl-pds">'</span></span> <span class="pl-k">+</span> err);
    }
});

<span class="pl-c">// Somewhere else for example</span>
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>system.monitor.update<span class="pl-pds">'</span></span>);

ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>client.message<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Hi guys!<span class="pl-pds">'</span></span>);</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="quick-comparison-to-other-libs" class="anchor" href="#quick-comparison-to-other-libs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick comparison to other libs</h1>

<table>
<thead>
<tr>
<th>Topic</th>
<th>Wampy.js</th>
<th>AutobahnJS</th>
</tr>
</thead>
<tbody>
<tr>
<td>Runs on</td>
<td>browser</td>
<td>browser and NodeJS</td>
</tr>
<tr>
<td>Dependencies</td>
<td>msgpack.js (optional), jDataView (optional)</td>
<td>when.js, CryptoJS (optional)</td>
</tr>
<tr>
<td>Creating connection</td>
<td>var connection = new Wampy('ws://127.0.0.1:9000/', { realm: 'realm1' });</td>
<td>var connection = new autobahn.Connection({url: 'ws://127.0.0.1:9000/', realm: 'realm1'});</td>
</tr>
<tr>
<td>Opening a connection</td>
<td>connection opens on creating an instance, or can be opened by: connection.connect()</td>
<td>connection.open();</td>
</tr>
<tr>
<td>Connection Callbacks</td>
<td>Wampy supports next callbacks: onConnect, onClose, onError, onReconnect. Callbacks can be specified via options object passed to constructor, or via .options() method.</td>
<td>AutobahnJS provides two callbacks: connection.onopen = function (session) { } and connection.onclose = function (reason/string, details/dict) { }</td>
</tr>
<tr>
<td>WAMP API methods with parameters</td>
<td>While using Wampy you don't have to explicitly specify the payload type (single value, array, object), just pass it to api method. <br>For example:<br>ws.publish('chat.message.received', 'user message');<br>ws.publish('chat.message.received', ['user message1', 'user message2']);<br>ws.publish('chat.message.received', { message: 'user message'});<br>Also Wampy is clever enough to understand some specific options, for example, if you specify a success or error callback to publish method, Wampy will automatically set acknowledge flag to true.</td>
<td>In AutobahnJS you need to use only arrays and objects, as it's specified in WAMP, and also choose right argument position.<br>For example:<br>session.publish('com.myapp.hello', ['Hello, world!']);<br>session.publish('com.myapp.hello', [], {message: 'Hello, world!'});<br>Also you need to explicitly provide additional options, like {acknowledge: true}</td>
</tr>
<tr>
<td>Method callbacks</td>
<td>Most of the API methods take a <strong>callbacks</strong> parameter, which is hash-table of posible callbacks</td>
<td>AutobahnJS make use of <strong>Deffered</strong> object, and most of API methods return a deferred object, so you can specify callbacks using .then() method</td>
</tr>
<tr>
<td>Chaining support</td>
<td>Wampy supports methods chaining.<br>connection.subscribe(...).publish(...).call(...)</td>
<td></td>
</tr>
</tbody>
</table>

<p>Which one library to use - choice is yours!</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Wampy.js can be installed using bower or npm or just by file-copy :)</p>

<div class="highlight highlight-bash"><pre><span class="pl-k">&gt;</span> bower install wampy.js
<span class="pl-c"># Or</span>
<span class="pl-k">&gt;</span> npm install wampy</pre></div>

<p>To use Wampy simply add wampy-all.min.js file to your page. It contains all the necessary
libs: jdataview - for handling UInt64 data and msgpack encoder.</p>

<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>wampy-all.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<p>In case, you don't plan to use msgpack, just include clean wampy.min.js.</p>

<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>wampy.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="methods" class="anchor" href="#methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Methods</h1>

<h2>
<a id="constructorurl-options" class="anchor" href="#constructorurl-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Constructor([url[, options]])</h2>

<p>Wampy constructor can take 2 parameters:</p>

<ul>
<li>
<strong>url</strong> to wamp server - optional. If its undefined, page-schema://page-server:page-port/ws will be used.
Can be in forms of:

<ul>
<li>fully qualified url: schema://server:port/path</li>
<li>server:port/path. In this case page schema will be used.</li>
<li>/path. In this case page schema, server, port will be used.</li>
</ul>
</li>
<li>
<strong>options</strong> hash-table. The only required field is <code>realm</code>. See description below.</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Wampy</span>();
ws <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Wampy</span>(<span class="pl-s"><span class="pl-pds">'</span>/my-socket-path<span class="pl-pds">'</span></span>);
ws <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Wampy</span>(<span class="pl-s"><span class="pl-pds">'</span>ws://socket.server.com:5000/ws<span class="pl-pds">'</span></span>, { autoReconnect<span class="pl-k">:</span> <span class="pl-c1">false</span> });
ws <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Wampy</span>({ reconnectInterval<span class="pl-k">:</span> <span class="pl-c1">1</span><span class="pl-k">*</span><span class="pl-c1">1000</span> });</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="optionsopts" class="anchor" href="#optionsopts" aria-hidden="true"><span class="octicon octicon-link"></span></a>options([opts])</h2>

<p>.options() method can be called in two forms:</p>

<ul>
<li>without parameters it will return current options</li>
<li>with one parameter as hash-table it will set new options. Support chaining.</li>
</ul>

<p>Options attributes description:</p>

<ul>
<li>
<strong>autoReconnect</strong>. Default value: true. Enable autoreconnecting. In case of connection failure, Wampy will try to reconnect to WAMP server, and if you were subscribed to any topics,
or had registered some procedures, Wampy will resubscribe to that topics and reregister procedures.</li>
<li>
<strong>reconnectInterval</strong>. Default value: 2000 (ms). Reconnection Interval in ms.</li>
<li>
<strong>maxRetries</strong>. Default value: 25. Max reconnection attempts. After reaching this value <a href="#disconnect">.disconnect()</a>
will be called</li>
<li>
<strong>transportEncoding</strong>. Default value: json. Transport serializer to use. Supported 2 values: json|msgpack.
For using msgpack you need to include msgpack javascript library, and also wamp server, that also supports it.</li>
<li>
<strong>realm</strong>. Default value: undefined. WAMP Realm to join on server. See WAMP spec for additional info.</li>
<li>
<strong>onConnect</strong>. Default value: undefined. Callback function. Fired when connection to wamp server is established.</li>
<li>
<strong>onClose</strong>. Default value: undefined. Callback function. Fired on closing connection to wamp server.</li>
<li>
<strong>onError</strong>. Default value: undefined. Callback function. Fired on error in websocket communication.</li>
<li>
<strong>onReconnect</strong>. Default value: undefined. Callback function. Fired every time on reconnection attempt.</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">options</span>();

ws.<span class="pl-c1">options</span>({
    reconnectInterval<span class="pl-k">:</span> <span class="pl-c1">1000</span>,
    maxRetries<span class="pl-k">:</span> <span class="pl-c1">999</span>,
    <span class="pl-en">onConnect</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Yahoo! We are online!<span class="pl-pds">'</span></span>); },
    <span class="pl-en">onClose</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>See you next time!<span class="pl-pds">'</span></span>); },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Breakdown happened<span class="pl-pds">'</span></span>); },
    <span class="pl-en">onReconnect</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Reconnecting...<span class="pl-pds">'</span></span>); }
});</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="getopstatus" class="anchor" href="#getopstatus" aria-hidden="true"><span class="octicon octicon-link"></span></a>getOpStatus()</h2>

<p>Returns the status of last operation. Wampy is developed in a such way, that every operation returns <strong>this</strong> even
in case of error to suport chaining. But if you want to know status of last operation, you can call .getOpStatus().
This method returns an object with 2 or 3 attributes: code and description and possible request ID . 
Code is integer, and value &gt; 0 means error.
Description is a description of code.
Request ID is integer and may be useful in some cases (call canceling for example).</p>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>system.monitor.update<span class="pl-pds">'</span></span>);
ws.<span class="pl-c1">getOpStatus</span>();
<span class="pl-c">// may return { code: 1, description: "Topic URI doesn't meet requirements!" }</span>
<span class="pl-c">// or { code: 2, description: "Server doesn't provide broker role!" }</span>
<span class="pl-c">// or { code: 0, description: "Success!", reqId: 1565723572 }</span></pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="getsessionid" class="anchor" href="#getsessionid" aria-hidden="true"><span class="octicon octicon-link"></span></a>getSessionId()</h2>

<p>Returns the WAMP Session ID.</p>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">getSessionId</span>();</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="connecturl" class="anchor" href="#connecturl" aria-hidden="true"><span class="octicon octicon-link"></span></a>connect([url])</h2>

<p>Connects to wamp server. <strong>url</strong> parameter is the same as specified in <a href="#constructor">Constructor</a>.
Supports chaining.</p>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">connect</span>();
ws.<span class="pl-c1">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>/my-socket-path<span class="pl-pds">'</span></span>);
ws.<span class="pl-c1">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>wss://socket.server.com:5000/ws<span class="pl-pds">'</span></span>);</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="disconnect" class="anchor" href="#disconnect" aria-hidden="true"><span class="octicon octicon-link"></span></a>disconnect()</h2>

<p>Disconnects from wamp server. Clears all queues, subscription, calls. Supports chaining.</p>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">disconnect</span>();</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="abort" class="anchor" href="#abort" aria-hidden="true"><span class="octicon octicon-link"></span></a>abort()</h2>

<p>Aborts WAMP session and closes a websocket connection.  Supports chaining. 
If it is called on handshake stage - it sends a abort message to wamp server (as described in spec).
Also clears all queues, subscription, calls. Supports chaining.</p>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">abort</span>();</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="subscribetopicuri-callbacks" class="anchor" href="#subscribetopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>subscribe(topicURI, callbacks)</h2>

<p>Subscribes for topicURI events. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>topicURI</strong>. Required. A string that identifies the topic.
Must meet a WAMP Spec URI requirements.</li>
<li>
<p><strong>callbacks</strong>. If it is a function - it will be treated as published event callback
         or it can be hash table of callbacks:</p>

<pre><code>   { onSuccess: will be called when subscribe would be confirmed
     onError: will be called if subscribe would be aborted
     onEvent: will be called on receiving published event }
</code></pre>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">subscribe</span>(<span class="pl-s"><span class="pl-pds">'</span>chat.message.received<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">msg</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Received new chat message!<span class="pl-pds">'</span></span>); });

ws.<span class="pl-c1">subscribe</span>(<span class="pl-s"><span class="pl-pds">'</span>some.another.topic<span class="pl-pds">'</span></span>, {
   <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Successfully subscribed to topic<span class="pl-pds">'</span></span>); },
   <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Subscription error:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> err); },
   <span class="pl-en">onEvent</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Received topic event<span class="pl-pds">'</span></span>); }
});</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="unsubscribetopicuri-callbacks" class="anchor" href="#unsubscribetopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>unsubscribe(topicURI[, callbacks])</h2>

<p>Unsubscribe from topicURI events. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>topicURI</strong>. Required. A string that identifies the topic.
Must meet a WAMP Spec URI requirements.</li>
<li>
<p><strong>callbacks</strong>. If it is a function - it will be treated as published event callback to remove
         or it can be hash table of callbacks:</p>

<pre><code>   { onSuccess: will be called when unsubscribe would be confirmed
     onError: will be called if unsubscribe would be aborted
     onEvent: published event callback to remove }
</code></pre>

<p>or it can be not specified, in this case all callbacks and subscription will be removed.</p>
</li>
</ul>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> <span class="pl-en">f1</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) { ... };
ws.<span class="pl-c1">unsubscribe</span>(<span class="pl-s"><span class="pl-pds">'</span>subscribed.topic<span class="pl-pds">'</span></span>, f1);

ws.<span class="pl-c1">unsubscribe</span>(<span class="pl-s"><span class="pl-pds">'</span>chat.message.received<span class="pl-pds">'</span></span>);</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="publishtopicuri-payload-callbacks-advancedoptions" class="anchor" href="#publishtopicuri-payload-callbacks-advancedoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>publish(topicURI[, payload[, callbacks[, advancedOptions]]])</h2>

<p>Publish a new event to topic. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>topicURI</strong>. Required. A string that identifies the topic.
Must meet a WAMP Spec URI requirements.</li>
<li>
<strong>payload</strong>. Publishing event data. Optional. May be any single value or array or hash-table object or null.</li>
<li>
<p><strong>callbacks</strong>. Optional hash table of callbacks:</p>

<pre><code>   { onSuccess: will be called when publishing would be confirmed
     onError: will be called if publishing would be aborted }
</code></pre>
</li>
<li>
<p><strong>advancedOptions</strong>. Optional parameter. Must include any or all of the options:</p>

<pre><code>   { exclude:    integer|array WAMP session id(s) that won't receive a published event, even though they may be subscribed
     eligible:   integer|array WAMP session id(s) that are allowed to receive a published event
     exclude_me: bool flag of receiving publishing event by initiator (if it is subscribed to this topic)
     disclose_me: bool flag of disclosure of publisher identity (its WAMP session ID) to receivers of a published event }
</code></pre>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>user.logged.in<span class="pl-pds">'</span></span>);
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>chat.message.received<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>user message<span class="pl-pds">'</span></span>);
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>chat.message.received<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>user message1<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>user message2<span class="pl-pds">'</span></span>]);
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>user.modified<span class="pl-pds">'</span></span>, { field1<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>field1<span class="pl-pds">'</span></span>, field2<span class="pl-k">:</span> <span class="pl-c1">true</span>, field3<span class="pl-k">:</span> <span class="pl-c1">123</span> });
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>user.modified<span class="pl-pds">'</span></span>, { field1<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>field1<span class="pl-pds">'</span></span>, field2<span class="pl-k">:</span> <span class="pl-c1">true</span>, field3<span class="pl-k">:</span> <span class="pl-c1">123</span> }, {
  <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>User successfully modified<span class="pl-pds">'</span></span>); }
});
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>user.modified<span class="pl-pds">'</span></span>, { field1<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>field1<span class="pl-pds">'</span></span>, field2<span class="pl-k">:</span> <span class="pl-c1">true</span>, field3<span class="pl-k">:</span> <span class="pl-c1">123</span> }, {
  <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> () { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>User successfully modified<span class="pl-pds">'</span></span>); },
  <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>User modification failed<span class="pl-pds">'</span></span>, err); }
});
ws.<span class="pl-c1">publish</span>(<span class="pl-s"><span class="pl-pds">'</span>chat.message.received<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>Private message<span class="pl-pds">'</span></span>], <span class="pl-c1">null</span>, { eligible<span class="pl-k">:</span> <span class="pl-c1">123456789</span> });</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="calltopicuri-payload-callbacks-advancedoptions" class="anchor" href="#calltopicuri-payload-callbacks-advancedoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>call(topicURI[, payload[, callbacks[, advancedOptions]]])</h2>

<p>Make a RPC call to topicURI. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>topicURI</strong>. Required. A string that identifies the remote procedure to be called.
Must meet a WAMP Spec URI requirements.</li>
<li>
<strong>payload</strong>. RPC data. Optional. May be any single value or array or hash-table object or null.</li>
<li>
<p><strong>callbacks</strong>. If it is a function - it will be treated as result callback function
         or it can be hash table of callbacks:</p>

<pre><code>   { onSuccess: will be called with result on successful call
     onError: will be called if invocation would be aborted }
</code></pre>
</li>
<li>
<p><strong>advancedOptions</strong>. Optional parameter. Must include any or all of the options:</p>

<pre><code>   { exclude: integer|array WAMP session id(s) providing an explicit list of (potential)
              Callees that a call won't be forwarded to, even though they might be registered
     eligible: integer|array WAMP session id(s) providing an explicit list of (potential)
               Callees that are (potentially) forwarded the call issued
     exclude_me: bool flag of potentially forwarding call to caller if he is registered as callee
     disclose_me: bool flag of disclosure of Caller identity (WAMP session ID)
                to endpoints of a routed call
     receive_progress: bool flag for receiving progressive results. In this case onSuccess function
                will be called every time on receiving result }
</code></pre>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">call</span>(<span class="pl-s"><span class="pl-pds">'</span>server.time<span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>, <span class="pl-k">function</span> (<span class="pl-smi">data</span>) { <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Server time is <span class="pl-pds">'</span></span> <span class="pl-k">+</span> d[<span class="pl-c1">0</span>]); });

ws.<span class="pl-c1">call</span>(<span class="pl-s"><span class="pl-pds">'</span>start.migration<span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>, {
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC successfully called<span class="pl-pds">'</span></span>);
    },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC call failed!<span class="pl-pds">'</span></span>,err);
    }
});

ws.<span class="pl-c1">call</span>(<span class="pl-s"><span class="pl-pds">'</span>restore.backup<span class="pl-pds">'</span></span>, { backupFile<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>backup.zip<span class="pl-pds">'</span></span> }, {
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Backup successfully restored<span class="pl-pds">'</span></span>);
    },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>Restore failed!<span class="pl-pds">'</span></span>,err);
    }
});</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="cancelreqid-callbacks-advancedoptions" class="anchor" href="#cancelreqid-callbacks-advancedoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>cancel(reqId, callbacks, advancedOptions)</h2>

<p>RPC invocation cancelling. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>reqId</strong>. Required. Request ID of RPC call that need to be canceled.</li>
<li>
<p><strong>callbacks</strong>. Optional. If it is a function - it will be called if successfully sent canceling message
        or it can be hash table of callbacks:</p>

<pre><code>  { onSuccess: will be called if successfully sent canceling message
    onError: will be called if some error occurred }
</code></pre>
</li>
<li>
<p><strong>advancedOptions</strong>. Optional parameter. Must include any or all of the options:</p>

<pre><code>  { mode: string|one of the possible modes:
          "skip" | "kill" | "killnowait". Skip is default. }
</code></pre>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">call</span>(<span class="pl-s"><span class="pl-pds">'</span>start.migration<span class="pl-pds">'</span></span>, <span class="pl-c1">null</span>, {
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC successfully called<span class="pl-pds">'</span></span>);
    },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC call failed!<span class="pl-pds">'</span></span>,err);
    }
});
status <span class="pl-k">=</span> ws.<span class="pl-c1">getOpStatus</span>();

ws.<span class="pl-c1">cancel</span>(status.<span class="pl-c1">reqId</span>);
</pre></div>

<h2>
<a id="registertopicuri-callbacks" class="anchor" href="#registertopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>register(topicURI, callbacks)</h2>

<p>RPC registration for invocation. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>topicURI</strong>. Required. A string that identifies the remote procedure to be called.
Must meet a WAMP Spec URI requirements.</li>
<li>
<p><strong>callbacks</strong>. Required. If it is a function - it will be treated as rpc itself
         or it can be hash table of callbacks:</p>

<pre><code>   { rpc: registered procedure
     onSuccess: will be called on successful registration
     onError: will be called if registration would be aborted }
</code></pre>
</li>
</ul>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> <span class="pl-en">sqrt_f</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">x</span>) { <span class="pl-k">return</span> x<span class="pl-k">*</span>x; };


ws.<span class="pl-c1">register</span>(<span class="pl-s"><span class="pl-pds">'</span>sqrt.value<span class="pl-pds">'</span></span>, sqrt_f);

ws.<span class="pl-c1">register</span>(<span class="pl-s"><span class="pl-pds">'</span>sqrt.value<span class="pl-pds">'</span></span>, {
    rpc<span class="pl-k">:</span> sqrt_f,
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC successfully registered<span class="pl-pds">'</span></span>);
    },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC registration failed!<span class="pl-pds">'</span></span>,err);
    }
});</pre></div>

<p>Also wampy supports rpc with asynchronous code, such as some user interactions or xhr, using promises. For using this functionality in old browsers you should use polyfills, like <a href="https://github.com/jakearchibald/es6-promise">es6-promise</a>. Check brower support at <a href="http://caniuse.com/#search=promise">can i use</a> site.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> <span class="pl-en">getUserName</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () { 
    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">resolve</span>, <span class="pl-smi">reject</span>) {
        <span class="pl-c">/* Ask user to input his username somehow,</span>
<span class="pl-c">           and resolve promise with user input at the end */</span>
        <span class="pl-c1">resolve</span>(userInput);
    });
};

ws.<span class="pl-c1">register</span>(<span class="pl-s"><span class="pl-pds">'</span>get.user.name<span class="pl-pds">'</span></span>, getUserName);</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="unregistertopicuri-callbacks" class="anchor" href="#unregistertopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>unregister(topicURI, callbacks)</h2>

<p>RPC unregistration from invocations. Supports chaining.</p>

<p>Parameters:</p>

<ul>
<li>
<strong>topicURI</strong>. Required. A string that identifies the remote procedure to be called.
Must meet a WAMP Spec URI requirements.</li>
<li>
<p><strong>callbacks</strong>. Optional. If it is a function - it will be called on successful unregistration
         or it can be hash table of callbacks:</p>

<pre><code>   { onSuccess: will be called on successful unregistration
     onError: will be called if unregistration would be aborted }
</code></pre>
</li>
</ul>

<div class="highlight highlight-javascript"><pre>ws.<span class="pl-c1">unregister</span>(<span class="pl-s"><span class="pl-pds">'</span>sqrt.value<span class="pl-pds">'</span></span>);

ws.<span class="pl-c1">unregister</span>(<span class="pl-s"><span class="pl-pds">'</span>sqrt.value<span class="pl-pds">'</span></span>, {
    <span class="pl-en">onSuccess</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC successfully unregistered<span class="pl-pds">'</span></span>);
    },
    <span class="pl-en">onError</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
        <span class="pl-en">console</span><span class="pl-c1">.log</span>(<span class="pl-s"><span class="pl-pds">'</span>RPC unregistration failed!<span class="pl-pds">'</span></span>,err);
    }
});</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="tests-and-code-coverage" class="anchor" href="#tests-and-code-coverage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tests and code coverage</h1>

<p>Wampy.js uses mocha and chai for tests and istanbul for code coverage. You can run both from cli</p>

<div class="highlight highlight-bash"><pre><span class="pl-c"># run tests with mocha (use your own favorite reporter)</span>
<span class="pl-k">&gt;</span> mocha -R spec
<span class="pl-c"># or use standart npm test command</span>
<span class="pl-k">&gt;</span> npm <span class="pl-c1">test</span>

<span class="pl-c"># for code coverage report run</span>
<span class="pl-k">&gt;</span> npm run-script cover
<span class="pl-c"># and then open coverage/lcov-report/index.html</span>
</pre></div>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="copyright-and-license" class="anchor" href="#copyright-and-license" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright and License</h1>

<p>Wampy.js library is licensed under the MIT License (MIT).</p>

<p>Copyright (c) 2014 Konstantin Burkalev</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="see-also" class="anchor" href="#see-also" aria-hidden="true"><span class="octicon octicon-link"></span></a>See Also</h1>

<ul>
<li><a href="http://wamp.ws">WAMP specification</a></li>
<li>
<a href="http://ksdaemon.github.io/wiola/">Wiola</a> - WAMP in Lua on top of nginx/openresty</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/KSDaemon/wampy.js">Wampy.js</a> is maintained by <a href="https://github.com/KSDaemon">KSDaemon</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-52132189-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
