!function(a,b){if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.constants=c.exports}}(this,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};a.WAMP_MSG_SPEC={HELLO:1,WELCOME:2,ABORT:3,CHALLENGE:4,AUTHENTICATE:5,GOODBYE:6,ERROR:8,PUBLISH:16,PUBLISHED:17,SUBSCRIBE:32,SUBSCRIBED:33,UNSUBSCRIBE:34,UNSUBSCRIBED:35,EVENT:36,CALL:48,CANCEL:49,RESULT:50,REGISTER:64,REGISTERED:65,UNREGISTER:66,UNREGISTERED:67,INVOCATION:68,INTERRUPT:69,YIELD:70},a.WAMP_ERROR_MSG={SUCCESS:{code:0,description:"Success!"},URI_ERROR:{code:1,description:"Topic URI doesn't meet requirements!"},NO_BROKER:{code:2,description:"Server doesn't provide broker role!"},NO_CALLBACK_SPEC:{code:3,description:"No required callback function specified!"},INVALID_PARAM:{code:4,description:"Invalid parameter(s) specified!"},NON_EXIST_UNSUBSCRIBE:{code:7,description:"Trying to unsubscribe from non existent subscription!"},NO_DEALER:{code:12,description:"Server doesn't provide dealer role!"},RPC_ALREADY_REGISTERED:{code:15,description:"RPC already registered!"},NON_EXIST_RPC_UNREG:{code:17,description:"Received rpc unregistration for non existent rpc!"},NON_EXIST_RPC_INVOCATION:{code:19,description:"Received invocation for non existent rpc!"},NON_EXIST_RPC_REQ_ID:{code:20,description:"No RPC calls in action with specified request ID!"},NO_REALM:{code:21,description:"No realm specified!"},NO_WS_OR_URL:{code:22,description:"No websocket provided or URL specified is incorrect!"},NO_CRA_CB_OR_ID:{code:23,description:"No onChallenge callback or authid was provided for authentication!"},CRA_EXCEPTION:{code:24,description:"Exception raised during CRA challenge processing"}},a.ALLOWED_BINARY_TYPES=["blob","arraybuffer"],a.isNode="object"===("undefined"==typeof process?"undefined":b(process))&&"[object process]"===Object.prototype.toString.call(process)}),function(a,b){if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.JsonSerializer=c.exports}}(this,function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();a.JsonSerializer=function(){function a(){b(this,a),this.protocol="json",this.binaryType="blob"}return c(a,[{key:"encode",value:function(a){return JSON.stringify(a)}},{key:"decode",value:function(a){return JSON.parse(a)}}]),a}()}),function(a,b){if("function"==typeof define&&define.amd)define(["exports","msgpack5"],b);else if("undefined"!=typeof exports)b(exports,require("msgpack5"));else{var c={exports:{}};b(c.exports,a.msgpack5),a.MsgpackSerializer=c.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0}),a.MsgpackSerializer=void 0;var e=c(b),f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=(0,e.default)();a.MsgpackSerializer=function(){function a(){d(this,a),this.protocol="msgpack",this.binaryType="arraybuffer"}return f(a,[{key:"encode",value:function(a){return g.encode(a)}},{key:"decode",value:function(a){return g.decode(new Uint8Array(a))}}]),a}()}),function(a,b){if("function"==typeof define&&define.amd)define(["exports","./constants"],b);else if("undefined"!=typeof exports)b(exports,require("./constants"));else{var c={exports:{}};b(c.exports,a.constants),a.utils=c.exports}}(this,function(a,b){"use strict";function c(a){var b=void 0,c=void 0;return/^ws(s)?:\/\//.test(a)?a:(b="https:"===window.location.protocol?"wss://":"ws://",a?"/"===a[0]?(c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+a):b+a:(c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+"/ws"))}function d(a){return/^ws(s)?:\/\//.test(a)?a:null}function e(a,e,f){var g=b.isNode?d(a):c(a);return g?f?new f(g,e):b.isNode?null:"WebSocket"in window?new window.WebSocket(g,e):"MozWebSocket"in window?new window.MozWebSocket(g,e):null:null}function f(a){return b.ALLOWED_BINARY_TYPES.indexOf(a)!==-1}Object.defineProperty(a,"__esModule",{value:!0}),a.getWebSocket=e,a.isBinaryTypeAllowed=f}),function(a,b){if("function"==typeof define&&define.amd)define(["exports","./constants","./utils","./serializers/JsonSerializer"],b);else if("undefined"!=typeof exports)b(exports,require("./constants"),require("./utils"),require("./serializers/JsonSerializer"));else{var c={exports:{}};b(c.exports,a.constants,a.utils,a.JsonSerializer),a.wampy=c.exports}}(this,function(a,b,c,d){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0}),a.Wampy=void 0;var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Wampy=function(){function Wampy(a,b){e(this,Wampy),this.version="v4.1.0",this._url="string"==typeof a?a:null,this._protocols=["wamp.2.json"],this._wamp_features={agent:"Wampy.js "+this.version,roles:{publisher:{features:{subscriber_blackwhite_listing:!0,publisher_exclusion:!0,publisher_identification:!0}},subscriber:{},caller:{features:{caller_identification:!0,progressive_call_results:!0,call_canceling:!0,call_timeout:!0}},callee:{features:{caller_identification:!0}}}},this._cache={sessionId:null,server_wamp_features:{roles:{}},isSayingGoodbye:!1,opStatus:{code:0,description:"Success!",reqId:0},timer:null,reconnectingAttempts:0},this._ws=null,this._wsQueue=[],this._requests={},this._calls={},this._subscriptions={},this._subsTopics=new Set,this._rpcRegs={},this._rpcNames=new Set,this._options={debug:!1,autoReconnect:!0,reconnectInterval:2e3,maxRetries:25,realm:null,helloCustomDetails:null,authid:null,authmethods:[],onChallenge:null,onConnect:null,onClose:null,onError:null,onReconnect:null,onReconnectSuccess:null,ws:null,serializer:new d.JsonSerializer},this._isPlainObject(b)?this._options=this._merge(this._options,b):this._isPlainObject(a)&&(this._options=this._merge(this._options,a)),this.connect()}return f(Wampy,[{key:"_log",value:function(){this._options.debug}},{key:"_getReqId",value:function(){var a=void 0,b=55;do a=Math.floor(Math.random()*b);while(a in this._requests);return a}},{key:"_merge",value:function(){var a={},b=arguments.length,c=void 0,d=void 0;for(c=0;c<b;c++)for(d in arguments[c])a[d]=arguments[c][d];return a}},{key:"_isArray",value:function(a){return!!a&&Array.isArray(a)}},{key:"_isPlainObject",value:function(a){return!!a&&a.constructor===Object}},{key:"_setWsProtocols",value:function(){this._options.serializer instanceof d.JsonSerializer||this._protocols.unshift("wamp.2."+this._options.serializer.protocol)}},{key:"_preReqChecks",value:function(a,c,d){var e=!0;return this._cache.sessionId&&!this._cache.server_wamp_features.roles[c]&&(this._cache.opStatus=b.WAMP_ERROR_MSG["NO_"+c.toUpperCase()],e=!1),a&&!this._validateURI(a)&&(this._cache.opStatus=b.WAMP_ERROR_MSG.URI_ERROR,e=!1),!!e||(this._isPlainObject(d)&&d.onError&&d.onError(this._cache.opStatus.description),!1)}},{key:"_validateURI",value:function(a){var b=/^([0-9a-zA-Z_]{2,}\.)*([0-9a-zA-Z_]{2,})$/;return!(!b.test(a)||0===a.indexOf("wamp"))}},{key:"_encode",value:function(a){try{return this._options.serializer.encode(a)}catch(a){throw new Error("[wampy] encoding exception!")}}},{key:"_decode",value:function(a){try{return this._options.serializer.decode(a)}catch(a){throw new Error("[wampy] decoding exception!")}}},{key:"_send",value:function(a){if(a&&this._wsQueue.push(this._encode(a)),this._ws&&1===this._ws.readyState&&this._cache.sessionId)for(;this._wsQueue.length;)this._ws.send(this._wsQueue.shift())}},{key:"_resetState",value:function(){this._wsQueue=[],this._subscriptions={},this._subsTopics=new Set,this._requests={},this._calls={},this._rpcRegs={},this._rpcNames=new Set,this._cache={reconnectingAttempts:0}}},{key:"_initWsCallbacks",value:function(){var a=this;this._ws&&(this._ws.onopen=function(){a._wsOnOpen()},this._ws.onclose=function(b){a._wsOnClose(b)},this._ws.onmessage=function(b){a._wsOnMessage(b)},this._ws.onerror=function(b){a._wsOnError(b)})}},{key:"_wsOnOpen",value:function(){var a=this._merge(this._options.helloCustomDetails,this._wamp_features);this._options.authid&&(a.authmethods=this._options._authmethods,a.authid=this._options.authid),this._log("[wampy] websocket connected");var d=this._options.serializer.binaryType;if(!(0,c.isBinaryTypeAllowed)(d))throw new Error("Binary type is not allowed: "+d);this._ws.binatyType=d,this._ws.send(this._encode([b.WAMP_MSG_SPEC.HELLO,this._options.realm,a]))}},{key:"_wsOnClose",value:function(a){var c=this,d=b.isNode?global:window;this._log("[wampy] websocket disconnected. Info: ",a),(this._cache.sessionId||this._cache.reconnectingAttempts)&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries&&!this._cache.isSayingGoodbye?(this._cache.sessionId=null,this._cache.timer=d.setTimeout(function(){c._wsReconnect()},this._options.reconnectInterval)):(this._options.onClose&&this._options.onClose(),this._resetState(),this._ws=null)}},{key:"_wsOnMessage",value:function(a){var c=this,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;switch(this._log("[wampy] websocket message received",a.data),d=this._decode(a.data),d[0]){case b.WAMP_MSG_SPEC.WELCOME:this._cache.sessionId=d[1],this._cache.server_wamp_features=d[2],this._cache.reconnectingAttempts?(this._cache.reconnectingAttempts=0,this._options.onReconnectSuccess&&this._options.onReconnectSuccess(),this._renewSubscriptions(),this._renewRegistrations()):this._options.onConnect&&this._options.onConnect(),this._send();break;case b.WAMP_MSG_SPEC.ABORT:this._options.onError&&this._options.onError(d[1].message?d[1].message:d[2]),this._ws.close();break;case b.WAMP_MSG_SPEC.CHALLENGE:this._options.authid&&"function"==typeof this._options.onChallenge?(h=new Promise(function(a,b){a(c._options.onChallenge(d[1],d[2]))}),h.then(function(a){c._ws.send(c._encode([b.WAMP_MSG_SPEC.AUTHENTICATE,a,{}]))}).catch(function(a){c._ws.send(c._encode([b.WAMP_MSG_SPEC.ABORT,{message:"Exception in onChallenge handler raised!"},"wamp.error.cannot_authenticate"])),c._options.onError&&c._options.onError(b.WAMP_ERROR_MSG.CRA_EXCEPTION.description),c._ws.close(),c._cache.opStatus=b.WAMP_ERROR_MSG.CRA_EXCEPTION})):(this._ws.send(this._encode([b.WAMP_MSG_SPEC.ABORT,{message:b.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID.description},"wamp.error.cannot_authenticate"])),this._options.onError&&this._options.onError(b.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID.description),this._ws.close(),this._cache.opStatus=b.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID);break;case b.WAMP_MSG_SPEC.GOODBYE:this._cache.isSayingGoodbye||(this._cache.isSayingGoodbye=!0,this._send([b.WAMP_MSG_SPEC.GOODBYE,{},"wamp.error.goodbye_and_out"])),this._cache.sessionId=null,this._ws.close();break;case b.WAMP_MSG_SPEC.ERROR:switch(d[1]){case b.WAMP_MSG_SPEC.SUBSCRIBE:case b.WAMP_MSG_SPEC.UNSUBSCRIBE:case b.WAMP_MSG_SPEC.PUBLISH:case b.WAMP_MSG_SPEC.REGISTER:case b.WAMP_MSG_SPEC.UNREGISTER:this._requests[d[2]]&&this._requests[d[2]].callbacks.onError&&this._requests[d[2]].callbacks.onError(d[4],d[3],d[5],d[6]),delete this._requests[d[2]];break;case b.WAMP_MSG_SPEC.INVOCATION:break;case b.WAMP_MSG_SPEC.CALL:this._calls[d[2]]&&this._calls[d[2]].onError&&this._calls[d[2]].onError(d[4],d[3],d[5],d[6]),delete this._calls[d[2]];break;default:this._log("[wampy] Received non-compliant WAMP ERROR message")}break;case b.WAMP_MSG_SPEC.SUBSCRIBED:this._requests[d[1]]&&(this._subscriptions[this._requests[d[1]].topic]=this._subscriptions[d[2]]={id:d[2],callbacks:[this._requests[d[1]].callbacks.onEvent]},this._subsTopics.add(this._requests[d[1]].topic),this._requests[d[1]].callbacks.onSuccess&&this._requests[d[1]].callbacks.onSuccess(),delete this._requests[d[1]]);break;case b.WAMP_MSG_SPEC.UNSUBSCRIBED:this._requests[d[1]]&&(e=this._subscriptions[this._requests[d[1]].topic].id,delete this._subscriptions[this._requests[d[1]].topic],delete this._subscriptions[e],this._subsTopics.has(this._requests[d[1]].topic)&&this._subsTopics.delete(this._requests[d[1]].topic),this._requests[d[1]].callbacks.onSuccess&&this._requests[d[1]].callbacks.onSuccess(),delete this._requests[d[1]]);break;case b.WAMP_MSG_SPEC.PUBLISHED:this._requests[d[1]]&&(this._requests[d[1]].callbacks&&this._requests[d[1]].callbacks.onSuccess&&this._requests[d[1]].callbacks.onSuccess(),delete this._requests[d[1]]);break;case b.WAMP_MSG_SPEC.EVENT:if(this._subscriptions[d[1]])for(f=this._subscriptions[d[1]].callbacks.length;f--;)this._subscriptions[d[1]].callbacks[f](d[4],d[5]);break;case b.WAMP_MSG_SPEC.RESULT:this._calls[d[1]]&&(this._calls[d[1]].onSuccess(d[3],d[4]),d[2].progress&&d[2].progress===!0||delete this._calls[d[1]]);break;case b.WAMP_MSG_SPEC.REGISTERED:this._requests[d[1]]&&(this._rpcRegs[this._requests[d[1]].topic]=this._rpcRegs[d[2]]={id:d[2],callbacks:[this._requests[d[1]].callbacks.rpc]},this._rpcNames.add(this._requests[d[1]].topic),this._requests[d[1]].callbacks&&this._requests[d[1]].callbacks.onSuccess&&this._requests[d[1]].callbacks.onSuccess(),delete this._requests[d[1]]);break;case b.WAMP_MSG_SPEC.UNREGISTERED:this._requests[d[1]]&&(e=this._rpcRegs[this._requests[d[1]].topic].id,delete this._rpcRegs[this._requests[d[1]].topic],delete this._rpcRegs[e],this._rpcNames.has(this._requests[d[1]].topic)&&this._rpcNames.delete(this._requests[d[1]].topic),this._requests[d[1]].callbacks&&this._requests[d[1]].callbacks.onSuccess&&this._requests[d[1]].callbacks.onSuccess(),delete this._requests[d[1]]);break;case b.WAMP_MSG_SPEC.INVOCATION:this._rpcRegs[d[2]]?(h=new Promise(function(a,b){a(c._rpcRegs[d[2]].callbacks[0](d[4],d[5],d[3]))}),h.then(function(a){g=[b.WAMP_MSG_SPEC.YIELD,d[1],{}],c._isArray(a)?(c._isPlainObject(a[0])&&(g[2]=a[0]),c._isArray(a[1])?g.push(a[1]):"undefined"!=typeof a[1]&&g.push([a[1]]),c._isPlainObject(a[2])&&(3===g.length&&g.push([]),g.push(a[2]))):g=[b.WAMP_MSG_SPEC.YIELD,d[1],{}],c._send(g)}).catch(function(a){var e=[b.WAMP_MSG_SPEC.ERROR,b.WAMP_MSG_SPEC.INVOCATION,d[1],a.details||{},a.uri||"wamp.error.invocation_exception"];a.argsList&&c._isArray(a.argsList)&&e.push(a.argsList),a.argsDict&&c._isPlainObject(a.argsDict)&&(5===e.length&&e.push([]),e.push(a.argsDict)),c._send(e)})):(this._send([b.WAMP_MSG_SPEC.ERROR,b.WAMP_MSG_SPEC.INVOCATION,d[1],{},"wamp.error.no_such_procedure"]),this._cache.opStatus=b.WAMP_ERROR_MSG.NON_EXIST_RPC_INVOCATION);break;default:this._log("[wampy] Received non-compliant WAMP message")}}},{key:"_wsOnError",value:function(a){this._log("[wampy] websocket error"),this._options.onError&&this._options.onError(a)}},{key:"_wsReconnect",value:function(){this._log("[wampy] websocket reconnecting..."),this._options.onReconnect&&this._options.onReconnect(),this._cache.reconnectingAttempts++,this._ws=(0,c.getWebSocket)(this._url,this._protocols,this._options.ws),this._initWsCallbacks()}},{key:"_renewSubscriptions",value:function(){var a=void 0,b=this._subscriptions,c=this._subsTopics;this._subscriptions={},this._subsTopics=new Set;var d=!0,e=!1,f=void 0;try{for(var g,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;for(a=b[i].callbacks.length;a--;)this.subscribe(i,b[i].callbacks[a])}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}}},{key:"_renewRegistrations",value:function(){var a=this._rpcRegs,b=this._rpcNames;this._rpcRegs={},this._rpcNames=new Set;var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;this.register(h,{rpc:a[h].callbacks[0]})}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}}},{key:"options",value:function(a){return"undefined"==typeof a?this._options:this._isPlainObject(a)?(this._options=this._merge(this._options,a),this):void 0}},{key:"getOpStatus",value:function(){return this._cache.opStatus}},{key:"getSessionId",value:function(){return this._cache.sessionId}},{key:"connect",value:function(a){if(a&&(this._url=a),this._options.realm){var d=(this._options.authid?1:0)+(this._isArray(this._options.authmethods)&&this._options.authmethods.length?1:0)+("function"==typeof this._options.onChallenge?1:0);if(d>0&&d<3)return this._cache.opStatus=b.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID,this;if(this._setWsProtocols(),this._ws=(0,c.getWebSocket)(this._url,this._protocols,this._options.ws),!this._ws)return this._cache.opStatus=b.WAMP_ERROR_MSG.NO_WS_OR_URL,this;this._initWsCallbacks()}else this._cache.opStatus=b.WAMP_ERROR_MSG.NO_REALM;return this}},{key:"disconnect",value:function(){return this._cache.sessionId?(this._cache.isSayingGoodbye=!0,this._send([b.WAMP_MSG_SPEC.GOODBYE,{},"wamp.error.system_shutdown"])):this._ws&&this._ws.close(),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this}},{key:"abort",value:function(){return this._cache.sessionId||1!==this._ws.readyState||(this._send([b.WAMP_MSG_SPEC.ABORT,{},"wamp.error.abort"]),this._cache.sessionId=null),this._ws.close(),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this}},{key:"subscribe",value:function(a,c){var d=void 0;if(!this._preReqChecks(a,"broker",c))return this;if("function"==typeof c)c={onEvent:c};else if(!this._isPlainObject(c)||"undefined"==typeof c.onEvent)return this._cache.opStatus=b.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;return this._subscriptions[a]&&this._subscriptions[a].callbacks.length?(this._subscriptions[a].callbacks.indexOf(c.onEvent)<0&&this._subscriptions[a].callbacks.push(c.onEvent),c.onSuccess&&c.onSuccess()):(d=this._getReqId(),this._requests[d]={topic:a,callbacks:c},this._send([b.WAMP_MSG_SPEC.SUBSCRIBE,d,{},a])),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=d,this}},{key:"unsubscribe",value:function(a,c){var d=void 0,e=-1;return this._preReqChecks(null,"broker",c)?this._subscriptions[a]?(d=this._getReqId(),"undefined"==typeof c?(this._subscriptions[a].callbacks=[],c={}):"function"==typeof c?(e=this._subscriptions[a].callbacks.indexOf(c),c={}):c.onEvent&&"function"==typeof c.onEvent?e=this._subscriptions[a].callbacks.indexOf(c.onEvent):this._subscriptions[a].callbacks=[],e>=0&&this._subscriptions[a].callbacks.splice(e,1),this._subscriptions[a].callbacks.length?(this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this):(this._requests[d]={topic:a,callbacks:c},this._send([b.WAMP_MSG_SPEC.UNSUBSCRIBE,d,this._subscriptions[a].id]),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=d,this)):(this._cache.opStatus=b.WAMP_ERROR_MSG.NON_EXIST_UNSUBSCRIBE,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this):this}},{key:"publish",value:function(a,c,d,e){var f=void 0,g=void 0,h=!1,i={};if(!this._preReqChecks(a,"broker",d))return this;if(this._isPlainObject(d)&&(i.acknowledge=!0),"undefined"!=typeof e&&(this._isPlainObject(e)?(e.exclude&&(this._isArray(e.exclude)&&e.exclude.length?i.exclude=e.exclude:"number"==typeof e.exclude?i.exclude=[e.exclude]:h=!0),e.exclude_authid&&(this._isArray(e.exclude_authid)&&e.exclude_authid.length?i.exclude_authid=e.exclude_authid:"string"==typeof e.exclude_authid?i.exclude_authid=[e.exclude_authid]:h=!0),e.exclude_authrole&&(this._isArray(e.exclude_authrole)&&e.exclude_authrole.length?i.exclude_authrole=e.exclude_authrole:"string"==typeof e.exclude_authrole?i.exclude_authrole=[e.exclude_authrole]:h=!0),e.eligible&&(this._isArray(e.eligible)&&e.eligible.length?i.eligible=e.eligible:"number"==typeof e.eligible?i.eligible=[e.eligible]:h=!0),e.eligible_authid&&(this._isArray(e.eligible_authid)&&e.eligible_authid.length?i.eligible_authid=e.eligible_authid:"string"==typeof e.eligible_authid?i.eligible_authid=[e.eligible_authid]:h=!0),e.eligible_authrole&&(this._isArray(e.eligible_authrole)&&e.eligible_authrole.length?i.eligible_authrole=e.eligible_authrole:"string"==typeof e.eligible_authrole?i.eligible_authrole=[e.eligible_authrole]:h=!0),e.hasOwnProperty("exclude_me")&&(i.exclude_me=e.exclude_me!==!1),e.hasOwnProperty("disclose_me")&&(i.disclose_me=e.disclose_me===!0)):h=!0,h))return this._cache.opStatus=b.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(d)&&d.onError&&d.onError(this._cache.opStatus.description),this;switch(f=this._getReqId(),arguments.length){case 1:g=[b.WAMP_MSG_SPEC.PUBLISH,f,i,a];break;case 2:g=this._isArray(c)?[b.WAMP_MSG_SPEC.PUBLISH,f,i,a,c]:this._isPlainObject(c)?[b.WAMP_MSG_SPEC.PUBLISH,f,i,a,[],c]:[b.WAMP_MSG_SPEC.PUBLISH,f,i,a,[c]];break;default:this._requests[f]={topic:a,callbacks:d},g=this._isArray(c)?[b.WAMP_MSG_SPEC.PUBLISH,f,i,a,c]:this._isPlainObject(c)?[b.WAMP_MSG_SPEC.PUBLISH,f,i,a,[],c]:[b.WAMP_MSG_SPEC.PUBLISH,f,i,a,[c]]}return this._send(g),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=f,this}},{key:"call",value:function(a,c,d,e){var f=void 0,g=void 0,h=!1,i={};if(!this._preReqChecks(a,"dealer",d))return this;if("function"==typeof d)d={onSuccess:d};else if(!this._isPlainObject(d)||"undefined"==typeof d.onSuccess)return this._cache.opStatus=b.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(d)&&d.onError&&d.onError(this._cache.opStatus.description),this;if("undefined"!=typeof e&&(this._isPlainObject(e)?(e.hasOwnProperty("disclose_me")&&(i.disclose_me=e.disclose_me===!0),e.hasOwnProperty("receive_progress")&&(i.receive_progress=e.receive_progress===!0),e.hasOwnProperty("timeout")&&("number"==typeof e.timeout?i.timeout=e.timeout:h=!0)):h=!0,h))return this._cache.opStatus=b.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(d)&&d.onError&&d.onError(this._cache.opStatus.description),this;do f=this._getReqId();while(f in this._calls);return this._calls[f]=d,g=null===c?[b.WAMP_MSG_SPEC.CALL,f,i,a]:this._isArray(c)?[b.WAMP_MSG_SPEC.CALL,f,i,a,c]:this._isPlainObject(c)?[b.WAMP_MSG_SPEC.CALL,f,i,a,[],c]:[b.WAMP_MSG_SPEC.CALL,f,i,a,[c]],this._send(g),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=f,this}},{key:"cancel",value:function(a,c,d){var e={mode:"skip"};return this._preReqChecks(null,"dealer",c)?a&&this._calls[a]?("undefined"!=typeof d&&this._isPlainObject(d)&&d.hasOwnProperty("mode")&&(e.mode=/skip|kill|killnowait/.test(d.mode)?d.mode:"skip"),this._send([b.WAMP_MSG_SPEC.CANCEL,a,e]),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=a,c.onSuccess&&c.onSuccess(),this):(this._cache.opStatus=b.WAMP_ERROR_MSG.NON_EXIST_RPC_REQ_ID,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this):this}},{key:"register",value:function(a,c){var d=void 0;if(!this._preReqChecks(a,"dealer",c))return this;if("function"==typeof c)c={rpc:c};else if(!this._isPlainObject(c)||"undefined"==typeof c.rpc)return this._cache.opStatus=b.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;return this._rpcRegs[a]&&this._rpcRegs[a].callbacks.length?(this._cache.opStatus=b.WAMP_ERROR_MSG.RPC_ALREADY_REGISTERED,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description)):(d=this._getReqId(),this._requests[d]={topic:a,callbacks:c},this._send([b.WAMP_MSG_SPEC.REGISTER,d,{},a]),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=d),this}},{key:"unregister",value:function(a,c){var d=void 0;return this._preReqChecks(a,"dealer",c)?("function"==typeof c&&(c={onSuccess:c}),this._rpcRegs[a]?(d=this._getReqId(),this._requests[d]={topic:a,callbacks:c},this._send([b.WAMP_MSG_SPEC.UNREGISTER,d,this._rpcRegs[a].id]),this._cache.opStatus=b.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=d):(this._cache.opStatus=b.WAMP_ERROR_MSG.NON_EXIST_RPC_UNREG,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description)),this):this}}]),Wampy}();a.default=Wampy,a.Wampy=Wampy});
//# sourceMappingURL=wampy.min.js.map